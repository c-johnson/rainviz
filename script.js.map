{"version":3,"sources":["script.coffee"],"names":[],"mappings":"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","file":"script.js","sourceRoot":"/source/","sourcesContent":["class RainThing\n  constructor: () ->\n    @californication(new CanvasDrawer)\n    # @refugeeChart()\n\n  californication: (drawer) ->\n    d3.csv 'data/cal-boundary.csv', (data) ->\n      width = 960\n      height = 500\n\n      canvas = d3.select(\"body\").append(\"canvas\")\n        .attr(\"width\", width)\n        .attr(\"height\", height)\n\n      geoCali = new GeoPolygon(_.map data, (dat) -> {lat: parseFloat(dat.lat), long: parseFloat(dat.long)})\n      window.Cali = geoCali\n      gJson = geoCali.geoJson\n\n      projection = d3.geo.albers()\n        .scale(1000)\n\n      context = canvas.node().getContext(\"2d\")\n\n      caliPath = d3.geo.path(gJson.features[0])\n        .projection(projection)\n        .context(context)\n\n      gJson.features[0].bbox = gJson.bounds\n      caliPath(topojson.feature(gJson, gJson.features[0]))\n\n      # caliPath(topojson.feature(us, us.objects.counties));\n      context.stroke()\n\n      # b_canvas = document.getElementById(\"calicanvas\")\n      # b_context = b_canvas.getContext(\"2d\");\n      # b_context.fillRect(50, 25, 150, 100);\n\n      # caliPath.bounds(geoCali.geoJson.bounds);\n      # caliPath.projection(d3.geo.albersUsa());\n      # caliPath.context(b_context);\n\n      # drawer.drawCanvasThing(500, 500, geoCali.geoJson.bounds, geoCali.geoJson)\n\n  refugeeChart: () ->\n    d3.csv 'data/chart.csv', (data) ->\n      refugeeMax = data[data.length - 1].numRefugees\n      refugeeMin = data[0].numRefugees\n      div = d3.select('.the-data').append('div').attr('class', 'tooltip').style('opacity', 0)\n      d3.select('.the-data').selectAll('div').data(data).enter().append('div').classed 'data-row', true\n      d3.selectAll('.data-row').append('div').classed('bar', true).style('background-color', (d) ->\n        if d.numRefugees <= 100000\n          return 'green'\n        else if d.numRefugees > 100000 and d.numRefugees <= 500000\n          return 'yellow'\n        else if d.numRefugees > 500000 and d.numRefugees <= 2000000\n          return 'orange'\n        else if d.numRefugees > 2000000\n          return 'red'\n        return\n      ).style('height', (d) ->\n        percent = d.numRefugees / refugeeMax\n        barHeight = percent * 250\n        barHeight + 10 + 'px'\n      ).on('mouseover', (d) ->\n        div.transition().duration(0).style 'opacity', .9\n        div.html(d.numRefugees + '<br/>' + 'refugees').style('left', d3.event.pageX + 'px').style 'top', d3.event.pageY - 28 + 'px'\n        return\n      ).on 'mouseout', (d) ->\n        div.transition().duration(0).style 'opacity', 0\n        return\n      d3.selectAll('.data-row').append('p').classed('label', true).text (data) ->\n        data.date\n      return\n    console.log 'you are now rocking with d3', d3\n\nclass GeoPolygon\n  constructor: (coords) ->\n    @geoJson =\n      \"type\": \"FeatureCollection\"\n      \"features\": [{\n        \"type\": \"Feature\"\n        \"bounds\": []\n        \"geometry\":\n          \"type\": \"Polygon\"\n          \"coordinates\": coords\n    }]\n\n    @updateCoords(coords)\n\n  fLen: () ->\n    return @geoJson?.features?.length\n\n  updateFeature: (ind, newCoords) ->\n    if feature = @geoJson?.features[ind]\n      feature.geometry?.coordinates = newCoords\n      @geoJson.bounds = bounds = [[], []]\n                        #left, top, right, bottom\n      # @geoJson.bounds = [[10, 10], [50, 80]]\n\n      for newCoord in newCoords\n        long = newCoord.long\n        lat = newCoord.lat\n\n        bounds[0][0] = bounds.xMin = if bounds.xMin < long then bounds.xMin else long\n        bounds[1][0] = bounds.xMax = if bounds.xMax > long then bounds.xMax else long\n        bounds[1][1] = bounds.yMin = if bounds.yMin < lat then bounds.yMin else lat\n        bounds[0][1] = bounds.yMax = if bounds.yMax > lat then bounds.yMax else lat\n\n  updateCoords: (newCoords, index) =>\n    if index then @updateFeature(index, newCoords)\n    else\n      for i in [0..@fLen()]\n        @updateFeature(i, newCoords)\n\nclass CanvasDrawer\n  constructor: () ->\n    @canvas = document.createElement('canvas')\n    @context = @canvas.getContext(\"2d\")\n\n  drawCanvasThing: (width, height, bounds, data) ->\n    canvas = @canvas\n    context = undefined\n    coords = undefined\n    point = undefined\n    latitude = undefined\n    longitude = undefined\n    xScale = undefined\n    yScale = undefined\n    scale = undefined\n    # Get the drawing context from our <canvas> and\n    # set the fill to determine what color our map will be.\n    context = canvas.getContext('2d')\n    context.fillStyle = '#333'\n    # Determine how much to scale our coordinates by\n    xScale = width / Math.abs(bounds.xMax - (bounds.xMin))\n    yScale = height / Math.abs(bounds.yMax - (bounds.yMin))\n    scale = if xScale < yScale then xScale else yScale\n    # Again, we want to use the “features” key of\n    # the FeatureCollection\n    data = data.features\n    # Loop over the features…\n    i = 0\n    while i < data.length\n      # …pulling out the coordinates…\n      coords = data[i].geometry.coordinates[0]\n      # …and for each coordinate…\n      j = 0\n      while j < coords.length\n        longitude = coords[j][0]\n        latitude = coords[j][1]\n        # Scale the points of the coordinate\n        # to fit inside our bounding box\n        point =\n          x: (longitude - (bounds.xMin)) * scale\n          y: (bounds.yMax - latitude) * scale\n        # If this is the first coordinate in a shape, start a new path\n        if j == 0\n          @context.beginPath()\n          @context.moveTo point.x, point.y\n          # Otherwise just keep drawing\n        else\n          @context.lineTo point.x, point.y\n        j++\n      # Fill the path we just finished drawing with color\n      @context.fill()\n      i++\n    return\n\nthing = new RainThing\n"]}